

import numpy as np 
import pandas as pd 
import matplotlib.pyplot as plt

students = {
    "S001": "Alice Johnson",
    "S002": "Bob Williams",
    "S003": "Charlie Brown",
    "S004": "Dana Scully",
    "S005": "MARehman"
}

gradebook = {
    "S001": {
        "Homework": [90, 85, 95],
        "Midterm": [88],
        "Final": [92]
    },
    "S002": {
        "Homework": [70, 75, 80],
        "Midterm": [65],
        "Final": [72]
    },
    "S003": {
        "Homework": [100, 98, 100],
        "Midterm": [95],
        "Final": [99]
    },
    "S004": {
        "Homework": [50, 60, 55],
        "Midterm": [40],
        "Final": [50]
    },
    "S005": {
        "Homework": [60, 60, 60],
        "Midterm": [60],
        "Final": [100]
    }
            }


WEIGHTS = {
    "Homework": 0.30, # 30%
    "Midterm": 0.30,  # 30%
    "Final": 0.40     # 40%
}


# --- Calculation Function ---

def calculate_final_grade(student_id):
    """
    Calculates the weighted final grade for a student using the defined WEIGHTS.
    Returns the final grade percentage.
    """
    # 1. Get the student's scores, or use an empty dictionary if not found
    scores = gradebook.get(student_id, {})
    
    # Check if the student has any records at all
    if not scores:
        return 0.0 

    # 2. Extract scores for each category (default to empty list if key is missing)
    homework_scores = scores.get("Homework", [])
    midterm_scores = scores.get("Midterm", [])
    final_scores = scores.get("Final", [])
    
    # Homework Average
    homework_avg = sum(homework_scores) / len(homework_scores) if homework_scores else 0
    
    # Midterm Average (usually just one score, but treated as an average for consistency)
    midterm_avg = sum(midterm_scores) / len(midterm_scores) if midterm_scores else 0
    
    # Final Average
    final_avg = sum(final_scores) / len(final_scores) if final_scores else 0

    # 4. Apply the weights to the calculated averages.
    weighted_score = (
        (homework_avg * WEIGHTS["Homework"]) +
        (midterm_avg * WEIGHTS["Midterm"]) +
        (final_avg * WEIGHTS["Final"])
    )

    # 5. Return the final result, rounded to two decimal places.
    return round(weighted_score, 2)


# --- Data Collection Helper for Visualizations ---

def collect_all_final_grades():
    """Gathers all final grades into a list for plotting."""
    all_grades = []
    for student_id in students:
        grade = calculate_final_grade(student_id)
        if grade > 0.0: # Only include students with some recorded data
            all_grades.append(grade)
    return all_grades


# --- Visualization Functions ---

import matplotlib.pyplot as plt
import collections # Used for simpler category averaging

## Grade Distribution Plotting (Simplified)
def plot_grade_distribution(grades, passing_threshold=70.0):
    """
    Generates a histogram of grades and a pie chart of Pass/Fail rates.
    """
    if not grades:
        print("Cannot plot grade distribution: No grades found.")
        return

    # Create figure and subplots in one step
    fig, (ax_hist, ax_pie) = plt.subplots(1, 2, figsize=(12, 6))

    # 1. Histogram (Grade Distribution) - Use the dedicated subplot axis
    ax_hist.hist(grades, bins=range(0, 101, 10), edgecolor='black', color='#3498db')
    ax_hist.axvline(passing_threshold, color='red', linestyle='dashed', linewidth=1,
                    label=f'Pass Threshold ({passing_threshold}%)')
    ax_hist.set_title('Final Grade Histogram')
    ax_hist.set_xlabel('Final Grade Percentage')
    ax_hist.set_ylabel('Number of Students')
    ax_hist.legend()
    ax_hist.grid(axis='y', alpha=0.5)

    # 2. Pie Chart (Pass/Fail Rate) - Simplified calculation with a generator expression
    num_passing = sum(1 for grade in grades if grade >= passing_threshold)
    num_failing = len(grades) - num_passing

    labels = [f'Pass (>= {passing_threshold}%)', f'Fail (< {passing_threshold}%)']
    sizes = [num_passing, num_failing]
    colors = ['#2ecc71', '#e74c3c']
    explode = (0.1, 0)

    # Use the dedicated subplot axis for the pie chart
    ax_pie.pie(sizes, explode=explode, labels=labels, colors=colors,
               autopct='%1.1f%%', shadow=True, startangle=90)
    ax_pie.set_title('Pass/Fail Rate')
    ax_pie.axis('equal') # Ensures the pie is circular

    fig.suptitle('Class Performance Analysis', fontsize=16)
    plt.tight_layout(rect=[0, 0.03, 1, 0.95]) # Adjust layout for suptitle
    plt.show()


## Assignment Performance Plotting (Simplified)
def plot_assignment_performance():
    """
    Calculates and plots the average score for each assignment category.
    """
    category_scores = collections.defaultdict(list)

    # 1. Collect all scores for each category using a more concise loop
    for student_id in gradebook:
        for category, scores_list in gradebook[student_id].items():
            category_scores[category].extend(scores_list)

    # 2. Calculate category averages using a dictionary comprehension
    category_averages = {
        category: round(sum(scores) / len(scores), 2)
        for category, scores in category_scores.items() if scores
    }

    if not category_averages:
        print("Cannot plot assignment performance: No assignment data found.")
        return

    categories = list(category_averages.keys())
    averages = list(category_averages.values())

    # Simple Bar Chart
    plt.figure(figsize=(9, 6)) # Slightly larger figure for text clarity
    bars = plt.bar(categories, averages, color=['#f1c40f', '#e67e22', '#c0392b'])

    plt.title('Average Class Score per Assignment Category')
    plt.xlabel('Assignment Category')
    plt.ylabel('Average Score (%)')
    plt.ylim(0, 100)

    for bar in bars:
        yval = bar.get_height()
        plt.text(bar.get_x() + bar.get_width() / 2, yval + 2, f'{yval:.2f}%',
                 ha='center', va='bottom')

    plt.show()


# --- Display Function (Report Generation) ---
def generate_report(passing_threshold=70.0):
    """
    Prints a simple report showing each student's final grade and status.
    """
    print("--------------------------------")
    print("      SIMPLE COURSE GRADE REPORT    ")
    print("--------------------------------")

    # Combine status determination into a helper expression
    def get_status(grade):
        if grade == 0.0:
            return "No Data Recorded"
        elif grade < passing_threshold:
            return "Failing (At Risk)"
        else:
            return "Passing"

    # Loop through every student and print the report section
    for student_id, name in students.items():
        final_grade = calculate_final_grade(student_id)
        performance = get_status(final_grade)

        print(f"Student: {name}")
        print(f"  Final Grade: {final_grade}%")
        print(f"  Status: {performance}")
        print("--------------------------------")


generate_report()

print("\n--- Generating Visual Reports (Graphs will open in new windows) ---\n")

# 2. Collect the data needed for plotting
final_grades_data = collect_all_final_grades()

# 3. Generate the distribution plots (Histogram and Pass/Fail Pie Chart)
plot_grade_distribution(final_grades_data)

# 4. Generate the assignment performance plot (Bar Chart)
plot_assignment_performance()

print("\nProgram finished running and all graphs have been displayed.")
